// ai/ai.i18n.js
// Language + i18n strings for the AI Control Panel.

export function getLang(){
    try{
      var v = localStorage.getItem('lc_lang') || 'ru';
      v = String(v).toLowerCase();
      if (v.indexOf('de')===0) return 'de';
      if (v.indexOf('en')===0) return 'en';
      return 'ru';
    }catch(e){ return 'ru'; }
  }

export const AI_I18N = {
    ru: {
      title: "\uD83E\uDDE0 AI Control Panel",
      close: "Закрыть",
      status: "Статус:",
      not_tested: "Не проверено",
      connected: "Подключено",
      not_connected: "Не подключено",
      not_connected_tip: "LM Studio не запущена. Модель не обнаружена. Обратитесь к инструкции.",
      endpoint: "Endpoint:",
      test: "Проверить соединение",
      clearLog: "Очистить лог",
      models: "Модели (/v1/models):",
      validate: "Проверка:",
      validateBtn: "Проверить карточку (JSON)",
      source: "Источник:",
      sourceLeft: "Левый список (карточки)",
      sourceRight: "Правый список (черновик)",
      sourceLeftShort: "← ЛЕВЫЙ",
      sourceRightShort: "ПРАВЫЙ →",
      sourceTip: "Переключить источник проверки: красный = левый список, синий = правый (черновик)",
      valModeTip: "Дополнительно: проверить экспортный payload правого списка",
      valModeLabel: "validate export payload (cards-right)",
      meta: "Meta:",
      sourceHint: "Источник данных: window.LC_DIAG.",
      valNotRun: "Пока не запускали проверку.",
      okHead: "OK — ошибок не найдено.",
      failHead: "FAIL — есть ошибки, карточка неканонична.",
      errors: "Ошибки:",
      warnings: "Предупреждения:",
      payloadDebug: "Export payload (debug):",
      apply: "Применить",
      applyWarn: "Валидация не пройдена. Всё равно применить?",
      fixTipUnknown: "ИИ исправит недочёты на основе отчёта проверки.\nСостояние: не проверено",
      fixTipOk: "Недочётов не найдено.\nСостояние: OK",
      fixTipFail: "ИИ попробует исправить найденные ошибки.\nСостояние: FAIL ({n})",
      fixNotReady: "Авто-исправление будет добавлено на следующем шаге. Сейчас доступна проверка и отчёт."
      ,
      fix: "Исправить",
      report: "Отчёт ИИ",
      reportEmpty: "Пока нет действий ИИ.",
      reportWorking: "ИИ работает…",
      reportLast: "Последний запуск:",
      reportSummary: "Кратко:",
      reportActions: "Сделано:",
      reportWarnings: "Предупреждения:",
      reportRemaining: "Осталось проблем:",
      fixNoIssues: "Недочётов не найдено — исправлять нечего.",
      fixNeedValidate: "Сначала нажмите Проверка (Validate).",
      fixParseFail: "Не удалось разобрать ответ модели как JSON.",
      fixNetFail: "Ошибка связи с LM Studio.",
      fixDoneOk: "Fix завершён: валидация OK.",
      fixDoneFail: "Fix завершён: остались ошибки."
      ,
      gen: "Сгенерировать",
      genInf: "Инфинитив:",
      genPlaceholder: "Введите инфинитив или список (через запятую/пробел; фразы в кавычках)",
      genTip: "Сгенерировать новую карточку по инфинитиву (строго JSON). По умолчанию: черновик (правый список).",
	  genDraftRight: "Добавлено в черновик (правый список)",
      importBtn: "Внести глаголы файлом",
      importTip: "Импорт .txt: глаголы через запятую (можно с пробелами/переносами). Дальше генерация пойдёт автоматически по одному глаголу.",
      importBoxTitle: "Импорт глаголов",
      onlineVerifyLabel: "Онлайн‑проверка (Wiktionary)",
      onlineVerifyHint: "Проверяет формы/Perfekt/приставки через Wiktionary. Нужен интернет; при блокировке автоматически отключится.",
      listLabel: "Список",
      rightResultLabel: "Результат появится в правом списке",
      importIdle: "Импорт не запущен.",
      importPick: "Выберите .txt файл с глаголами через запятую.",
      importRunning: "Импорт: {done}/{total}. Текущий: {verb}",
      importDone: "Импорт завершён: {done}/{total}. Ошибок: {err}",
      importStop: "Остановить",
	      importStopped: "Импорт остановлен: {done}/{total}",
      moveLeft: "Перенести в левый список",
      moveLeftTip: "Перенести активную карточку из черновика в левый список и обновить историю.",
      activeCard: "Активная карточка:",
      noActiveCard: "нет активной карточки",
      needSelectCard: "Сначала выберите карточку в списке.",
      genTooShort: "Инфинитив слишком короткий.",
      genFail: "Генерация не удалась.",
      genInvalidJson: "Модель вернула невалидный ответ (не удалось разобрать JSON).",
      genRetrying: "Повторная попытка...",
      genOk: "Сгенерировано.",
      advanced: "Дополнительно",
      advancedTip: "Редкие/отладочные опции",
      valModeLabelShort: "Проверять экспорт (debug)",
      debug: "Дебаг",
      debugTip: "Показать/скрыть служебную информацию"
	  

    },
    de: {
      title: "\uD83E\uDDE0 AI Control Panel",
      close: "Schließen",
      status: "Status:",
      not_tested: "Nicht geprüft",
      connected: "Verbunden",
      not_connected: "Nicht verbunden",
      not_connected_tip: "LM Studio läuft nicht. Modell wurde nicht gefunden. Siehe Anleitung.",
      endpoint: "Endpoint:",
      test: "Verbindung testen",
      clearLog: "Log löschen",
      models: "Modelle (/v1/models):",
      validate: "Validierung:",
      validateBtn: "Karte prüfen (JSON)",
      source: "Quelle:",
      sourceLeft: "Linke Liste (Karten)",
      sourceRight: "Rechte Liste (Entwurf)",
      sourceLeftShort: "← LINKS",
      sourceRightShort: "RECHTS →",
      sourceTip: "Quelle umschalten: Rot = linke Liste, Blau = rechte Liste (Entwurf)",
      valModeTip: "Zusätzlich: Export-Payload der rechten Liste prüfen",
      valModeLabel: "Export-Payload prüfen (cards-right)",
      meta: "Meta:",
      sourceHint: "Datenquelle: window.LC_DIAG.",
      valNotRun: "Prüfung wurde noch nicht ausgeführt.",
      okHead: "OK — keine Fehler gefunden.",
      failHead: "FAIL — Fehler gefunden, Karte ist nicht kanonisch.",
      errors: "Fehler:",
      warnings: "Warnungen:",
      payloadDebug: "Export-Payload (Debug):",
      apply: "Übernehmen",
      applyWarn: "Validierung fehlgeschlagen. Trotzdem übernehmen?",
      fixTipUnknown: "Die KI behebt Mängel anhand des Prüfberichts.\nStatus: nicht geprüft",
      fixTipOk: "Keine Mängel gefunden.\nStatus: OK",
      fixTipFail: "Die KI versucht, die Fehler zu beheben.\nStatus: FAIL ({n})",
      fixNotReady: "Auto-Korrektur kommt im nächsten Schritt. Aktuell sind Prüfung und Bericht verfügbar."
      ,
      fix: "Korrigieren",
      report: "KI-Bericht",
      reportEmpty: "Noch keine KI-Aktionen.",
      reportWorking: "KI arbeitet…",
      reportLast: "Letzter Lauf:",
      reportSummary: "Kurz:",
      reportActions: "Erledigt:",
      reportWarnings: "Warnungen:",
      reportRemaining: "Offene Probleme:",
      fixNoIssues: "Keine Probleme gefunden — nichts zu korrigieren.",
      fixNeedValidate: "Bitte zuerst Validierung ausführen.",
      fixParseFail: "Antwort konnte nicht als JSON geparst werden.",
      fixNetFail: "Verbindungsfehler zu LM Studio.",
      fixDoneOk: "Fix fertig: Validierung OK.",
      fixDoneFail: "Fix fertig: Fehler bleiben bestehen."
      ,
      gen: "Generieren",
      genInf: "Infinitiv:",
      genPlaceholder: "Infinitiv oder Liste eingeben (Komma/Leerzeichen; Phrasen in Anführungszeichen)",
      genTip: "Neue Karte aus einem Infinitiv erzeugen (nur JSON). Standard: Entwurf (rechte Liste).",
	  genDraftRight: "In Entwurf (rechte Liste) hinzugefügt",
      importBtn: "Verben per Datei",
      importTip: "Import .txt: Verben durch Komma getrennt (Leerzeichen/Zeilenumbrüche ok). Danach wird automatisch nacheinander generiert.",
      importBoxTitle: "Verb-Import",
      onlineVerifyLabel: "Online-Prüfung (Wiktionary)",
      onlineVerifyHint: "Prüft Formen/Perfekt/Präfixe über Wiktionary. Internet nötig; bei Blockierung wird es automatisch deaktiviert.",
      listLabel: "Liste",
      rightResultLabel: "Ergebnis erscheint in der rechten Liste",
      importIdle: "Import nicht gestartet.",
      importPick: "Wählen Sie eine .txt Datei mit Verben (durch Komma getrennt).",
      importRunning: "Import: {done}/{total}. Aktuell: {verb}",
      importDone: "Import fertig: {done}/{total}. Fehler: {err}",
      importStop: "Stop",
      importStopped: "Import gestoppt: {done}/{total}",
      moveLeft: "In linke Liste verschieben",
      moveLeftTip: "Aktive Entwurfs-Karte in die linke Liste verschieben und Verlauf aktualisieren.",
      activeCard: "Aktive Karte:",
      noActiveCard: "keine aktive Karte",
      needSelectCard: "Bitte zuerst eine Karte in der Liste auswählen.",
      genTooShort: "Infinitiv ist zu kurz.",
      genFail: "Generierung fehlgeschlagen.",
      genInvalidJson: "Das Modell lieferte eine ungültige Antwort (JSON konnte nicht geparst werden).",
      genRetrying: "Neuer Versuch...",
      genOk: "Generiert.",
      advanced: "Erweitert",
      advancedTip: "Seltene/Debug-Optionen",
      valModeLabelShort: "Export prüfen (Debug)",
      debug: "Debug",
      debugTip: "Technische Details ein-/ausblenden"

    },
    en: {
      title: "\uD83E\uDDE0 AI Control Panel",
      close: "Close",
      status: "Status:",
      not_tested: "Not tested",
      connected: "Connected",
      not_connected: "Not connected",
      not_connected_tip: "LM Studio is not running. Model not found. See the instructions.",
      endpoint: "Endpoint:",
      test: "Test Connection",
      clearLog: "Clear Log",
      advanced: "Advanced",
      advancedTip: "Rare/debug options",
      models: "Models (/v1/models):",
      validate: "Validate:",
      validateBtn: "Validate Card JSON",
      source: "Source:",
      sourceLeft: "Left list (cards)",
      sourceRight: "Right list (draft)",
      sourceLeftShort: "← LEFT",
      sourceRightShort: "RIGHT →",
      sourceTip: "Toggle validation source: red = left list, blue = right list (draft)",
      valModeTip: "Extra: validate right list export payload",
      valModeLabel: "validate export payload (cards-right)",
      meta: "Meta:",
      sourceHint: "Data source: window.LC_DIAG.",
      valNotRun: "Validation not run yet.",
      okHead: "OK — no issues found.",
      failHead: "FAIL — issues detected; card is not canonical.",
      errors: "Errors:",
      warnings: "Warnings:",
      payloadDebug: "Export payload (debug):",
      apply: "Apply",
      applyWarn: "Validation failed. Apply anyway?",
      fixTipUnknown: "AI will fix detected issues based on the validation report.\nStatus: not checked",
      fixTipOk: "No issues found.\nStatus: OK",
      fixTipFail: "AI will try to fix detected issues.\nStatus: FAIL ({n})",
      fixNotReady: "Auto-fix will be added next. Validation and report are available now."
      ,
      fix: "Fix",
      report: "AI Report",
      reportEmpty: "No AI actions yet.",
      reportWorking: "AI is working…",
      reportLast: "Last run:",
      reportSummary: "Summary:",
      reportActions: "Actions:",
      reportWarnings: "Warnings:",
      reportRemaining: "Remaining issues:",
      fixNoIssues: "No issues found — nothing to fix.",
      fixNeedValidate: "Run Validate first.",
      fixParseFail: "Failed to parse the model response as JSON.",
      fixNetFail: "LM Studio connection error.",
      fixDoneOk: "Fix finished: validation OK.",
      fixDoneFail: "Fix finished: issues remain.",
      gen: "Generate",
      genInf: "Infinitive:",
      genPlaceholder: "Enter an infinitive or list (comma/space; phrases in quotes)",
      genTip: "Generate a new card from an infinitive (JSON only). Default: draft (right).",
	  genDraftRight: "Added to draft (right list)",
      importBtn: "Import verbs from file",
      importTip: "Import .txt: verbs separated by commas (spaces/newlines ok). Then it will auto-generate one by one.",
      importBoxTitle: "Batch import",
      onlineVerifyLabel: "Online verify (Wiktionary)",
      onlineVerifyHint: "Verifies forms/Perfekt/prefixes via Wiktionary. Requires internet; will auto-disable if blocked.",
      listLabel: "List",
      rightResultLabel: "Result will appear in the right list",
      importIdle: "Import not started.",
      importPick: "Pick a .txt file with verbs separated by commas.",
      importRunning: "Import: {done}/{total}. Current: {verb}",
      importDone: "Import finished: {done}/{total}. Errors: {err}",
      importStop: "Stop",
      importStopped: "Import stopped: {done}/{total}",
      moveLeft: "Move to left list",
      moveLeftTip: "Move active draft card to the left list and update history.",
      activeCard: "Active card:",
      noActiveCard: "no active card",
      needSelectCard: "Select a card in the list first.",
      genTooShort: "Infinitive is too short.",
      genFail: "Generation failed.",
      genInvalidJson: "Model returned invalid output (could not parse JSON).",
      genRetrying: "Retrying...",
      genOk: "Generated.",
      valModeLabelShort: "Validate export (Debug)",
      debug: "Debug",
      debugTip: "Show/hide technical details"


    }
  };

export function t(key, params){
    var lang = getLang();
    var s = (AI_I18N[lang] && AI_I18N[lang][key]) || (AI_I18N.ru && AI_I18N.ru[key]) || key;
    if (params){
      for (var k in params){
        s = s.split('{'+k+'}').join(String(params[k]));
      }
    }
    return s;
  }

// NOTE: A duplicate `t()` implementation existed here after modularization.
// Keeping the primary implementation above to avoid "Identifier 't' has already been declared".
